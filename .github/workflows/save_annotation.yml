name: Save Annotation

on:
  workflow_dispatch:
    inputs:
      json_content:
        description: 'Annotation JSON content'
        required: true
      annotator_name:
        description: 'Annotator name'
        required: true

jobs:
  create_pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up GitHub App authentication
        uses: tibdex/github-app-token@v1
        with:
          app_id: ${{ secrets.GITHUB_APP_ID }}
          private_key: ${{ secrets.GITHUB_APP_PRIVATE_KEY }}
          installation_id: ${{ secrets.GITHUB_APP_INSTALLATION_ID }}
        id: auth

      - name: Create branch and commit
        run: |
          DATE=$(date +%F)
          FILENAME="${DATE}_${{ github.event.inputs.annotator_name }}.json"
          echo "${{ github.event.inputs.json_content }}" > $FILENAME
          git config --global user.name "Annotation Bot"
          git config --global user.email "actions@github.com"
          git checkout -b "annotations/${FILENAME}"
          git add $FILENAME
          git commit -m "Add annotation file $FILENAME"
          git push origin HEAD
      - name: Create pull request
        uses: peter-evans/create-pull-request@v5
        with:
          branch: "annotations/${DATE}_${{ github.event.inputs.annotator_name }}"
          title: "Annotation by ${{ github.event.inputs.annotator_name }} on $DATE"
          body: "Automatically created annotation PR."
